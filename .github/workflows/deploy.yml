# ===================================================================
# üì¶ GitHub Actions Workflow: Auto-deploy Applab Backend to Server
# ===================================================================
# This workflow automatically connects to your Ubuntu server
# via SSH and runs your deployment script whenever you push code
# to the `master` branch of your backend repository.
# ===================================================================

name: Deploy Applab Backend

# ---------------------------------------------------------------
# üîÅ Trigger: This defines WHEN the workflow should run
# ---------------------------------------------------------------
on:
  push:              # Trigger this workflow whenever someone pushes new commits
    branches:
      - master       # Only run for commits pushed to the master branch

# ---------------------------------------------------------------
# üß© Job definition
# ---------------------------------------------------------------
jobs:
  deploy:
    name: Deploy to Applab Server
    runs-on: ubuntu-latest   # GitHub-hosted runner (temporary Linux machine)

    steps:
      # ---------------------------------------------------------
      # Step 1Ô∏è‚É£: Checkout the latest code from your repository
      # ---------------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # ---------------------------------------------------------
      # Step 2Ô∏è‚É£: SSH into your server and run deployment script
      # ---------------------------------------------------------
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: applab-api.arnabkhan.in           # Your server‚Äôs public IP or domain (set as a secret)
          username: root                          # Usually "root" or another user
          key: ${{ secrets.SERVER_SSH_KEY }}      # Private SSH key stored securely in GitHub Secrets
          script: |                               # Commands to run remotely
            cd /root/My_Scripts/Applications/applab      # Go to where your deploy script is stored
            chmod +x deploy-applab-backend.sh            # Ensure script is executable
            ./deploy-applab-backend.sh                   # Run your backend deployment script

# ===================================================================
# üìù Summary of required GitHub Secrets
# ===================================================================
# SERVER_HOST      ‚Üí Your server IP or domain (e.g., applab-api.arnabkhan.in)
# SERVER_USER      ‚Üí The SSH username (e.g., root)
# SERVER_SSH_KEY   ‚Üí The private key from ~/.ssh/github_deploy_key_applab_backen
# ===================================================================